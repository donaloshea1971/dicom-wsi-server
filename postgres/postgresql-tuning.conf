# PostgreSQL Performance Tuning for Orthanc WSI
# Optimized for 4GB RAM droplet - adjust values for your hardware

# =============================================================================
# Memory Configuration
# =============================================================================
# shared_buffers: 25% of RAM (but max ~1GB on small instances)
shared_buffers = 384MB

# effective_cache_size: 75% of RAM - tells planner how much OS cache to expect
effective_cache_size = 1GB

# work_mem: Memory for sorting/joins per operation (careful - per-connection)
work_mem = 16MB

# maintenance_work_mem: For VACUUM, CREATE INDEX
maintenance_work_mem = 128MB

# =============================================================================
# Query Performance
# =============================================================================
# SSD/NVMe optimization (lower = prefer index scans)
random_page_cost = 1.1

# Parallel I/O operations for SSD
effective_io_concurrency = 200

# Parallel query workers
max_parallel_workers_per_gather = 2
max_parallel_workers = 4

# =============================================================================
# Write Performance
# =============================================================================
# WAL buffers
wal_buffers = 16MB

# Checkpoint tuning
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# =============================================================================
# Connection Handling
# =============================================================================
max_connections = 100

# =============================================================================
# Logging (minimal for performance)
# =============================================================================
log_min_duration_statement = 1000
log_checkpoints = on
log_lock_waits = on
